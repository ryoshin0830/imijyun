# 意味順英語学習アプリケーション デザインドキュメント

**バージョン**: v1.0（作成日: 2025-09-08）
**対象読者**: 田地野彰先生、プロダクト/デザイン/開発チーム、営業/カスタマーサクセスチーム

---

## 1. エグゼクティブサマリー（1ページ）

**目的**
田地野彰先生の「意味順（だれが／する／なに／どこ／いつ）」メソッドを、現代のWeb/モバイル体験として実装・拡張し、日本人学習者が**文法用語に依存せず**英語の語順と意味の流れを直感的に体得できるプロダクトを構築する。

**プロダクトの核**

* 5色の意味順ボックスに単語/チャンクを**ドラッグ&ドロップ**して英語文を構築
* 即時フィードバック（正解：コンフェティ／誤答：振動＋ヒント）
* **SRS（間隔反復）×適応型難易度**で継続学習を最適化
* **ストーリーモード**と**キャラクター成長**でエンゲージメントを強化
* **B2B向け教師ダッシュボード**でクラス運営・評価・課題配信を支援

**現状**
Next.js 14／TypeScript／Tailwind／Zustand／Framer Motion／@dnd-kit／Turborepo は整備済み。UIの核体験とチュートリアル、レベル別レッスン、リアルタイムフィードバック、レスポンシブ対応は実装済。
**未実装**：認証・永続化、SRS、音声（TTS/STT）、B2B機能、レッスン拡充。

**3つの差別化ポイント**

1. **意味順特化**：英作文の思考順を視覚化し、語順の感覚を**手で組む**操作で身体化。
2. **文法用語を使わない説明**：年齢層横断で理解可能なUIマイクロコピーとヒント設計。
3. **教師の介入を前提**：B2Bで授業設計・宿題・到達度評価まで一気通貫。

**KPI（初年度→3年目）**

* D1/D7/D30 リテンション：35% / 20% / 12% → 45% / 28% / 18%
* 学習継続日数中央値：9日 → 18日
* 1日あたり完成文数中央値：18文 → 25文
* B2B継続率：80% → 90%
* ARPPU（B2C）：¥900 → ¥1,200

**ロードマップ概観**

* **Phase 2（1–2ヶ月）**：認証・永続化、SRS、XP/レベル、復習/スピードモード、フィードバック強化
* **Phase 3（3–6ヶ月）**：ストーリーモード、TTS/STT、ソーシャル、教師ダッシュボード
* **Phase 4（6–12ヶ月）**：モバイルアプリ、AI個別指導、多言語対応、スケール/運用最適化

---

## 2. プロダクトビジョン（2–3ページ）

### 2.1 教育的価値を最大化する体験原則

* **意味の流れを可視化**：5色ボックスの**意味役割**は常に固定（青=だれが/主、緑=する、黄=なに、紫=どこ、赤=いつ）。UI要素・サウンド・アニメーションはこの色体系に一貫。
* **「正解」より「再構築」**：誤答時は×ではなく**入替候補**や「先に“する（動き）”を置こう」等の**意味順ヒント**。
* **短い成功体験×反復**：1セッション3–5分／7–10問で**頻繁に達成感**。
* **用語回避**：ユーザー向け文言は**文法用語不使用**（内部ラベルはOK）。

### 2.2 ターゲットユーザー

* **小学生（8–12）**：ビジュアルと音声中心。短いセッション、保護者管理。
* **中高生（13–18）**：学校学習の補助。小テスト・宿題連携。
* **大学生・成人**：スピーキング起点の語順感覚獲得。出張/留学/資格補助。
* **教育機関**：公立/私立校、塾、語学学校。**クラス管理・評価**が主関心。

### 2.3 競合分析と差別化

* **一般的英語アプリ**（例：単語カード型）

  * 強み：語彙増強、SRSの定石
  * 弱み：語順・文生成の感覚化が弱い
  * **差別化**：**文構築の身体化**（ドラッグ&ドロップ）+ **意味順**ヒント
* **文法ドリル型**

  * 強み：体系的
  * 弱み：用語/ルールに依存し挫折率高
  * **差別化**：**用語非依存**の意味順導線＋**視覚×触覚**の統合
* **学校向けLMS**

  * 強み：配布・回収・成績
  * 弱み：言語習得のUIが古い
  * **差別化**：**教師オーサリング**×**意味順アセスメント**×**実時間授業支援**

### 2.4 3年後の姿（North Star）

* **国内No.1の語順トレーニング基盤**：学校/塾の標準副教材。
* **AI個別指導**で各学習者の弱点パターン（例えば「する→なに」の結合ミス）を特定し、**1日5分の最短ルート復習**を自動生成。
* **国際展開**：意味順の普遍性を活かし、他言語（ES→EN、ZH→EN等）にも応用。
* **研究連携**：学習データを匿名化し、**語順習得のエビデンス**を蓄積。

---

## 3. ユーザーエクスペリエンス設計（5–7ページ）

### 3.1 コア体験フロー

1. **デイリーゴール提示**（例：完成文15個／5分間）
2. **ドリル**：意味順ボックスにチャンクを配置 → 即時フィードバック → 軽量ヒント
3. **発話**（任意）：完成後に**読み上げ**→ユーザー**リピート録音**→音素レベルで簡易スコア
4. **リフレクション**：今日の弱点（例：「どこ」位置の誤り×3）、**次回のオススメ復習**
5. **報酬**：XP、連続日数、バッジ、ストーリー進行

### 3.2 ゲーミフィケーション戦略

* **ストーリーモード**：「英語の島」

  * 各エリア＝意味役割テーマ（港=だれが、森=する、マーケット=なに…）。
  * クエストは**文の発注**（NPCが意図を提示→ユーザーが文構築）。
* **キャラクター成長**

  * **アバター**：衣装/エモートをXPで解放。
  * **スキルツリー**：

    * *Flow*（語順スピードUP：制限時間延長）
    * *Clarity*（語彙ヒントを1回/セッション付与）
    * *Recall*（SRSの次回間隔を短縮）
* **バッジ/実績**

  * 例：「する先行マスター」（動きボックスを連続10問先に正置）
  * 「場所完璧週間」（紫ボックス誤り0で7日）
* **デイリーチャレンジ/イベント**

  * 平日：3分チャレンジ／週末：テーマ別イベント（旅行・学校・ビジネス）
* **ソーシャル**

  * **ランキング**：友達/クラス/全体
  * **協力**：協同クエスト（3人で各自1役割を担当し文を完成）

### 3.3 SRS（間隔反復）設計

* **学習アイテム**＝「意味順パターン×語彙チャンク」の組。
* **間隔モデル**：SM-2ベースを文構築に最適化

  * 品質評価Q（0–5）：**完全正解**=5／**位置ずれ1箇所**=4／**2箇所**=3／**ヒント使用**=2／**不正解**=1／**スキップ**=0
  * 次回間隔 `I(n) = I(n-1) * EF`（初期 `I1=1日, I2=3日`）、EF（Ease Factor）は `EF' = EF + (0.1 - (5-Q)*(0.08 + (5-Q)*0.02))`、下限1.3
* **復習面のUX**：

  * 当日カードは**最大10分**で打ち切り
  * 誤りパターンに応じて**局所練習**（例：「どこ」を先に固定した状態で他を再配置）

### 3.4 適応型難易度アルゴリズム

* **目標正答率**：80–85%
* **アイテム難度推定**：Elo（学習者θ、アイテムβ）

  * 予測正答確率 `P = 1 / (1 + e^{-(θ-β)})`
  * セッション内で`P`が連続して高/低すぎる場合に**βを±0.2**調整し出題を再サンプリング
* **個人化**：

  * **役割別θ**（だれが/する/なに/どこ/いつ）を別管理
  * **ミスの型**（入れ替え・欠落・過剰）をログ → 次回ヒントに反映

### 3.5 個人化された学習パス

* **初期診断**（5分）：各役割のθ初期化
* **学習計画**：

  * 平日：弱点2領域×各5問 + 維持5問
  * 週末：ストーリー進行＋復習一掃
* **コーチカード**：毎日1枚、「今日は“どこ”を先に置く練習を3回」

### 3.6 弱点分析と補強

* **メトリクス**：役割別正答率、初手誤り、再配置回数、ヒント依存率、発話可読率
* **補強手段**：

  * **固定型ドリル**（問題の一部を固定して他のみ可動）
  * **最小ペア**（“in/at/on”などの微差を、場所ボックス内の**選択**で比較）
  * **スピードモード**（時間プレッシャーで語順を自動化）

### 3.7 マルチモーダル学習

* **視覚**：色・アイコン・動きで役割を示す
* **聴覚**：TTSでモデル音声→ユーザーSTTで復唱→**タイミング×韻律×語順**を軽量評価
* **触覚**：モバイルの**軽振動**／正解時の**軽い弾け**アニメ

### 3.8 UI/UXデザイン方針

* **ビジュアルID**

  * 色：青(誰) #2563EB、緑(する) #16A34A、黄(なに) #F59E0B、紫(どこ) #8B5CF6、赤(いつ) #EF4444
  * タイポ：本文 *Noto Sans JP*、英字 *Inter*／タイトル *Noto Sans JP* Bold
  * アイコン：意味役割の**ピクト**（人・動き・対象・地図ピン・時計）
* **マイクロインタラクション**

  * ドロップ成功：弾性スナップ＋微細発光
  * 誤配置：赤枠バイブ＋「ここは“動き”の場所」ツールチップ
* **情報アーキテクチャ**

  * `/` ホーム → `/learn` 学習 → `/review` 復習 → `/story` 物語 → `/profile` → `/classroom`（教師）
* **アクセシビリティ（WCAG 2.2 AA）**

  * コントラスト比≧4.5:1、**色依存回避**（形状/ラベル併用）、キーボード操作、字幕・代替テキスト、読み上げ順
* **デバイス最適化**

  * モバイル：親指到達圏に主要操作、**片手操作**最適化
  * デスクトップ：ドラッグ範囲拡大、ショートカット（1–5で役割ジャンプ）

---

## 4. 技術仕様（3–4ページ）

### 4.1 アーキテクチャ概要

* **フロント**：Next.js 14 App Router（Server Components＋Client Components併用）、TypeScript、Tailwind、Zustand、Framer Motion、@dnd-kit
* **バックエンド**：Next.js Route Handlers（初期）、将来的に**Edge Functions**（Supabase/Cloudflare）へ一部移管
* **DB**：PostgreSQL（Supabase想定）
* **認証**：NextAuth（Email Magic Link + OAuth：Google/Apple/学校SSO/SAMLはB2B）
* **リアルタイム**：Supabase Realtime or Pusher（クラスライブ、対戦、教師モニタリング）
* **CDN**：Vercel Edge＋Asset（音声/画像）をCloudflare R2 + CDN
* **音声**：

  * **TTS**：Web Speech API（初期）→ 将来はクラウドTTS（日英高品質）
  * **STT**：Web Speech API（Chrome/Safari対応）→ 将来はクラウドSTT（ノイズ耐性・採点用）
* **AI個別指導**（Phase 4）：LLM API or 自前推論（セキュリティ/コスト配慮）

### 4.2 データモデル（抜粋）

```mermaid
erDiagram
  User ||--o{ Enrollment : has
  User ||--o{ Session : has
  User ||--o{ ReviewLog : has
  Class ||--o{ Enrollment : has
  Lesson ||--o{ Item : contains
  Item ||--o{ Attempt : logged
  Item ||--o{ ReviewLog : scheduled
  RoleMaster ||--o{ ItemRole : defines

  User {
    uuid id PK
    text email
    text display_name
    jsonb prefs               -- A11y, 通知, 目標
    timestamptz created_at
  }
  Lesson {
    uuid id PK
    text title
    jsonb syllabus            -- 目標役割, 語彙範囲
    int level                 -- 初/中/上
  }
  Item {
    uuid id PK
    uuid lesson_id FK
    jsonb chunks              -- {who:[...], do:[...], what:[...], where:[...], when:[...]}
    float beta                -- 難易度
  }
  Attempt {
    uuid id PK
    uuid user_id FK
    uuid item_id FK
    int quality               -- 0-5
    jsonb telemetry           -- ドロップ順, 再配置回数, 時間, ヒント
    timestamptz at
  }
  ReviewLog {
    uuid id PK
    uuid user_id FK
    uuid item_id FK
    int repetition
    float ef
    date due_on
    bool lapsed
  }
  Class {
    uuid id PK
    text name
    uuid teacher_id
  }
  Enrollment {
    uuid id PK
    uuid class_id
    uuid user_id
    jsonb permissions
  }
```

**インデックス**

* `Attempt(user_id, item_id, at)`、`ReviewLog(user_id, due_on)`、`Item(lesson_id, beta)`

**RLS（Row Level Security）**

* `User`: 自分のみ
* `Attempt/ReviewLog`: `user_id = auth.uid()`
* `Class/Enrollment`: 教師は自身のクラスのみ参照/更新、学校管理者はテナント単位

### 4.3 API（例・Route Handlers）

* `POST /api/session/start`（学習セッション開始、出題キュー返却）
* `POST /api/attempt`（結果送信：quality/telemetry）→ SRS更新・Elo更新
* `GET /api/review/due`（当日復習の取得）
* **教師用**

  * `GET /api/class/:id/progress`（クラス進捗・弱点ヒートマップ）
  * `POST /api/class/:id/assign`（課題配信：期限・対象レッスン）

### 4.4 適応/スケジューリング（擬似コード）

```pseudo
onAttempt(item_id, user_id, quality, role_error_map):
  # SRS
  RL = getReviewLog(user_id, item_id)
  if not RL: init with repetition=1, ef=2.5, due_on=tomorrow
  else:
    EF' = EF + (0.1 - (5-quality)*(0.08+(5-quality)*0.02))
    EF = max(1.3, EF')
    if quality < 3: repetition = 1; interval = 1
    else:
      repetition += 1
      interval = computeInterval(repetition, EF)   # 1, 3, 6, ...
    due_on = today + interval

  # Elo（役割別）
  for role in role_error_map:
    theta_u = getTheta(user_id, role)
    beta_i  = getBeta(item_id, role)
    p = 1/(1+exp(-(theta_u - beta_i)))
    k = 0.3
    score = (quality>=4 ? 1 : 0)                   # 正解扱いの閾値
    theta_u += k*(score - p)
    beta_i  -= k*(score - p)
    save(theta_u, beta_i)
```

### 4.5 パフォーマンス & CDN

* **目標**：LCP < 2.5s（3G回線想定）、交互作用<100ms
* **最適化**：RSCでデータ取得、画像/音声は`next/image`とストリーミング、Preload/Prefetch、ISR
* **音声**：短尺（<5s）を**Opus**へ変換しCDNキャッシュ

### 4.6 セキュリティ

* OAuth + Magic Link（二段階認証オプション）
* Supabase **RLS必須**、監査ログ、各種レート制限（IP/ユーザー/クラス）
* PII最小化、**未成年**の保護（保護者同意、学籍連携）、APPI/GDPR準拠
* 依存パッケージ監査（Dependabot）、Sentry/OWASP ASVS準拠チェック

### 4.7 運用と品質

* **テレメトリ**：イベント（Attempt/Hint/DropOrder/VoiceScore/TimeOnTask）
* **A/Bテスト**：ヒント文言、タイムリミット、報酬設計
* **自動テスト**：ユニット（ロジック/SRS/適応）、E2E（Playwright）、パフォーマンス（Lighthouse CI）
* **デプロイ**：Turborepoで分割、Vercel Preview→Main→Prod、DBマイグレーション（Prisma）

---

## 5. 実装ロードマップ（2–3ページ）

### Phase 2（1–2ヶ月）：コア強化

**目標**：日次継続率の向上と学習の循環を完成させる

* 認証/永続化（NextAuth + Supabase、RLS）
* SRS（SM-2変法）実装、**/review**フロー
* XP/レベル/連続日数、**改良フィードバック**（局所ヒント/固定型再挑戦）
* スピード/復習モード、学習履歴・弱点カード
* **レッスン拡充**：各レベル10→30（最低ライン）

**受け入れ基準**

* 当日復習が5分以内に消化可能
* 主要指標：D1>35%、1セッション平均完成文>15

### Phase 3（3–6ヶ月）：エンゲージメント

* **ストーリーモード**（1章=5エリア×各クエスト10）
* **音声**：TTS（高品質クラウド）/STT（クラウド）＋簡易発話スコア
* **ソーシャル**：フレンド・ランキング・協同クエスト
* **教師ダッシュボード**：クラス作成、進捗・弱点ヒートマップ、課題配信、CSV書き出し
* **学校SSO/SIS連携**（B2B）

**受け入れ基準**

* D7>20%、クラスの課題提出率>80%

### Phase 4（6–12ヶ月）：スケール/AI

* **モバイルアプリ**（PWA→Capacitor/React Native）
* **AI個別指導**：弱点から**1日5分プラン自動生成**、説明は用語非依存
* **多言語対応**（UI＋音声）
* **スケール**：Edge化、水平分割、コスト最適化

**受け入れ基準**

* 月間同時接続 1万以上で安定、p95応答<300ms

---

## 6. ビジネスプラン（2–3ページ）

### 6.1 モデル

* **B2C フリーミアム**

  * 無料：日次学習（上限あり）、基本復習、ストーリー序盤
  * プレミアム（月¥980/年¥7,800想定）：無制限復習、発話フィードバック詳細、スキルツリー拡張、イベント参加、オフライン
* **B2B ライセンス**

  * 学校/塾：1席/月¥400–¥700（規模割引）、管理者機能、SSO、レポート、優先サポート
  * 導入支援：研修・教材テンプレ・運用ハンドブック

### 6.2 価格戦略

* 学期単位割引、教育委員会/チェーン塾ボリュームディスカウント
* 保護者向け年払い優遇（2ヶ月分割安）

### 6.3 成功指標（KPI）

* 取得：CAC、自然流入比、教育機関獲得数
* 継続：D1/D7/D30、連続日数中央値、コホート残存
* 学習効果：役割別正答率の上昇、誤りパターンの減少、音声改善
* 収益：ARPU/ARPPU、B2B継続率、LTV/CAC

### 6.4 GTM（Go-To-Market）

* **学校実証**：先行3校での導入・授業内活用→ケーススタディ
* **コミュニティ**：先生向けウェビナー、教材コンテスト
* **メディア**：意味順×UI/教育効果の事例記事

---

## 7. リスク管理（1–2ページ）

| カテゴリ  | リスク                 | 影響 | 対策                                   |
| ----- | ------------------- | -: | ------------------------------------ |
| 技術    | 同時接続増でDB/Realtime輻輳 |  高 | 読取系を**Edge Cache**、書込をキュー化、パーティショニング |
| 技術    | ブラウザSTT/TTSの品質差     |  中 | クラウド音声にフォールバック、ネットワーク/端末診断           |
| ビジネス  | 競合の価格攻勢             |  中 | B2Bの**授業価値**（教師/評価）で差別化、長期契約割        |
| 教育    | 効果の不確実性             |  高 | 事前/事後テスト、**A/B**、大学/学校との共同研究         |
| 法務/倫理 | 未成年データ              |  高 | 保護者同意、匿名化、APPI/GDPR、データ保持最小化         |
| 運用    | コンテンツ拡充の遅延          |  中 | **オーサリングツール**整備、外部ライターガイドライン         |

---

## 8. 付録（モック/ワイヤー/仕様サンプル）

### 8.1 画面ワイヤー（テキスト案）

```
[ヘッダー] 目標: 15文 / 今日の連続: 3日目

[学習キャンバス]
 ┌青:だれが───────────┐  提示: "彼/She"
 ├緑:する─────────────────┤  提示: "買う/buy"
 ├黄:なに─────────────────┤  候補: "a book", "some apples"
 ├紫:どこ─────────────────┤  候補: "at the store", "online"
 └赤:いつ─────────────────┘  候補: "after school", "yesterday"

[下部]
 [ヒント] [スキップ] [音声] [確認]
```

### 8.2 レッスン作成ガイドライン（抜粋）

* **原則**：意味役割の**最小衝突**から導入、次に**微差対比**（in/at/on）。
* **チャンク化**：単語ベースではなく**チャンク**（“a cup of coffee”, “at the station”）。
* **語彙範囲**：CEFR A1→A2→B1に相当。
* **文例領域**：日常/学校/旅行/ビジネス/学術の5カテゴリを均等。
* **文化配慮**：固有名詞・状況設定は**多様性**を尊重、固定観念を避ける。

### 8.3 ヒントの言い換えテンプレート（用語回避）

* ✗「目的語が不足」→ **「“なに”の場所が空いているよ」**
* ✗「前置詞が誤り」→ **「“どこ”を表す言葉を選び直そう」**
* ✗「時制ミス」→ **「“いつ”に合わせて“する”の形も揃えよう」**

### 8.4 教師ダッシュボード（機能一覧）

* クラス作成/招待、課題配信（締切/対象/試行回数）、**弱点ヒートマップ**（役割×項目）、生徒別レポート、CSVエクスポート、**ライブ監視**（今プレイ中の問題数・誤り傾向）

### 8.5 イベント・アナリティクス（イベント名）

* `session_start`, `item_presented`, `drop_action`, `hint_shown(type)`, `attempt_submitted(quality)`, `voice_recorded(score)`, `review_scheduled(interval)`, `streak_updated`, `badge_unlocked(id)`

### 8.6 タイプ定義（抜粋・TypeScript）

```ts
type Role = 'who'|'do'|'what'|'where'|'when';

type ItemChunk = { text: string; audioUrl?: string; hints?: string[]; };
type Item = {
  id: string;
  lessonId: string;
  chunks: Record<Role, ItemChunk[]>;
  beta: number; // 難易度
};

type Attempt = {
  id: string;
  itemId: string;
  userId: string;
  quality: 0|1|2|3|4|5;
  telemetry: {
    dropOrder: Role[];
    reorders: number;
    timeMs: number;
    hintUsed: boolean;
    roleErrors: Partial<Record<Role, number>>;
  };
  at: string;
};
```

### 8.7 例：問題JSON

```json
{
  "lessonId": "L1-basic-where",
  "chunks": {
    "who": [{"text":"She"}],
    "do": [{"text":"buys"}],
    "what":[{"text":"a book"}],
    "where":[{"text":"at the store"},{"text":"online"}],
    "when":[{"text":"after school"}]
  },
  "beta": -0.2
}
```

---

# 実装詳細（要点メモ）

* **Zustand設計**：`useSessionStore`（現在の出題・タイマー・ヒント）、`useReviewStore`（Dueキュー）、`useProfileStore`（XP/連続日数/設定）
* **ドラッグ&ドロップ**：@dnd-kitで**スナップ先を役割スロット**に限定、誤配置は戻す。
* **フロント検証**：`quality`算出は**誤配置数・ヒント使用・所要時間**から。
* **アクセシビリティ**：ドラッグ不能環境向けに**キーボード操作**（Tab→Enterで配置）を提供。
* **オフライン**：Service Workerで**学習キューと音声**をプリフェッチ、Attemptは再接続時にバッチ送信。
* **コンテンツ拡張**：オーサリングUI（Googleスプレッドシート→CSV→検証→登録のパイプライン）
* **品質指標（教育）**：前後テストで**語順再現時間**と**誤り種**の変化を評価。

---

## 田地野先生とのミーティングで確認したい論点（チェックリスト）

1. **意味順の優先度**：初学段階で推奨する**提示順**（だれが→する→なに→どこ→いつ）は固定で良いか。
2. **誤りの扱い**：どの程度まで**ヒントで自動導出**させるか（完全誘導 vs 自己発見）。
3. **音声**：発話評価の**粒度**（語順と韻律中心でOKか）。
4. **ストーリーの役割**：意味役割と舞台（エリア）の**対応づけ**の妥当性。
5. **教師活用**：授業内**5–10分の導入**としての最適設計（投影/一斉操作/ライブ監視）。
6. **学習の証拠**：研究連携に向けた**評価設計**（データ項目と倫理配慮）。

---

### まとめ

本設計は、**意味順メソッドの本質（意味の流れ→語順）をUIで体感**させ、**反復×個人化**で定着、**物語と成長**で継続を促すことを中核に据えています。段階的にSRS/音声/教師機能/AIを統合し、**実装可能性とスケール**を両立させる計画です。明日の打合せでは、**教育的整合性**（ヒント表現・提示順・誤りの扱い）を最優先に、B2Bの授業運用像と評価方法を擦り合わせられると前進が早くなります。
